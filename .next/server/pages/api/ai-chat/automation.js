"use strict";(()=>{var e={};e.id=718,e.ids=[718],e.modules={8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,t,r)=>{e.exports=r(75600)},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},84119:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>d,routeModule:()=>p});var n={};r.r(n),r.d(n,{default:()=>o});var i=r(33480),a=r(8667),s=r(86435);async function o(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{rule:r,userId:n,sessionId:i}=e.body;if(!r)return t.status(400).json({error:"Automation rule is required"});let a=await u(r),s=await c(a,n);t.status(200).json({success:!0,rule:s,message:`Automation rule "${s.name}" has been created and activated.`})}catch(e){console.error("Automation API Error:",e),t.status(500).json({error:"Internal server error"})}}async function u(e){let t=e.toLowerCase(),r={},n=[],i="",a="";if(t.includes("roas")&&t.includes("<")){let e=t.match(/roas\s*<\s*(\d+\.?\d*)/);if(e){let t=parseFloat(e[1]);r={type:"metric_threshold",metric:"roas",operator:"<",value:t,timeframe:"24h"},i=`ROAS Alert - Below ${t}`,a=`Automatically triggers when ROAS drops below ${t}`}}if(t.includes("ctr")&&t.includes("<")){let e=t.match(/ctr\s*<\s*(\d+\.?\d*)/);if(e){let t=parseFloat(e[1]);r={type:"metric_threshold",metric:"ctr",operator:"<",value:t,timeframe:"24h"},i=`CTR Alert - Below ${t}%`,a=`Automatically triggers when CTR drops below ${t}%`}}if(t.includes("spend")&&t.includes(">")){let e=t.match(/spend\s*>\s*\$?(\d+)/);if(e){let t=parseInt(e[1]);r={type:"metric_threshold",metric:"spend",operator:">",value:t,timeframe:"24h"},i=`Spend Alert - Above $${t}`,a=`Automatically triggers when daily spend exceeds $${t}`}}return(t.includes("pause")||t.includes("stop"))&&n.push({type:"pause_campaign",description:"Pause the campaign"}),(t.includes("alert")||t.includes("notify"))&&n.push({type:"send_notification",channel:"whatsapp",message:"Campaign performance alert triggered"}),t.includes("budget")&&t.includes("increase")&&n.push({type:"adjust_budget",action:"increase",percentage:20,description:"Increase budget by 20%"}),t.includes("budget")&&t.includes("decrease")&&n.push({type:"adjust_budget",action:"decrease",percentage:20,description:"Decrease budget by 20%"}),t.includes("creative")&&t.includes("refresh")&&n.push({type:"refresh_creative",description:"Refresh campaign creatives"}),0===n.length&&n.push({type:"send_notification",channel:"whatsapp",message:"Automation rule triggered"}),{name:i,description:a,triggerCondition:r,actions:n,isActive:!0}}async function c(e,t){let r={id:`rule_${Date.now()}`,userId:t,name:e.name,description:e.description,triggerCondition:e.triggerCondition,actions:e.actions,isActive:e.isActive,createdAt:new Date().toISOString(),lastTriggered:null,triggerCount:0};return console.log("Storing automation rule:",r),r}let d=(0,s.M)(n,"default"),l=(0,s.M)(n,"config"),p=new i.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/ai-chat/automation",pathname:"/api/ai-chat/automation",bundlePath:"",filename:""},userland:n})},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=84119);module.exports=r})();