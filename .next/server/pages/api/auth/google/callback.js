"use strict";(()=>{var e={};e.id=201,e.ids=[201],e.modules={8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},12541:(e,t,r)=>{r.d(t,{A:()=>o});let o=(0,require("@supabase/supabase-js").createClient)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{persistSession:!0}})},21202:(e,t,r)=>{r.r(t),r.d(t,{config:()=>d,default:()=>l,routeModule:()=>p});var o={};r.r(o),r.d(o,{default:()=>u});var a=r(33480),n=r(8667),s=r(86435),i=r(21719),c=r(12541);async function u(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let{code:r,state:o}=e.query;if(!r)return t.status(400).json({error:"Missing code parameter"});try{let e=process.env.GOOGLE_REDIRECT_URI,a=await (0,i.gf)(r,e);if(!o)return t.status(400).json({error:"Missing user identification in state"});let{access_token:n,refresh_token:s,expires_in:u,id_token:l}=a,{error:d}=await c.A.from("google_tokens").upsert({user_id:o,access_token:n,refresh_token:s,expires_in:u,id_token:l,updated_at:new Date},{onConflict:"user_id"});if(d)throw d;return t.status(200).json({message:"Google OAuth token saved successfully"})}catch(e){return console.error("Error in Google OAuth callback:",e),t.status(500).json({error:"Failed to exchange token"})}}let l=(0,s.M)(o,"default"),d=(0,s.M)(o,"config"),p=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/auth/google/callback",pathname:"/api/auth/google/callback",bundlePath:"",filename:""},userland:o})},21719:(e,t,r)=>{r.d(t,{hD:()=>i,L1:()=>c,gf:()=>s});let o=require("node-fetch");var a=r.n(o),n=r(12541);async function s(e,t){try{let r=new URLSearchParams;r.append("client_id",process.env.GOOGLE_CLIENT_ID),r.append("client_secret",process.env.GOOGLE_CLIENT_SECRET),r.append("code",e),r.append("redirect_uri",t),r.append("grant_type","authorization_code");let o=await a()("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(!o.ok){let e=await o.json();throw Error(`Failed to get token: ${e.error_description||o.statusText}`)}return await o.json()}catch(e){throw console.error("Error in getToken:",e),e}}async function i(e){try{let{data:t,error:r}=await n.A.from("google_tokens").select("*").eq("user_id",e).single();if(r||!t)throw Error("Google token not found for user");let o=t.access_token,s=t.customer_id;if(!o||!s)throw Error("Missing access token or customer ID");let i=`https://googleads.googleapis.com/v11/customers/${s}/campaigns`,c=await a()(i,{headers:{Authorization:`Bearer ${o}`}});if(!c.ok){let e=await c.json();throw Error(`Failed to fetch ads data: ${e.error.message||c.statusText}`)}return await c.json()}catch(e){throw console.error("Error in fetchAdsData:",e),e}}async function c(e){try{let{data:t,error:r}=await n.A.from("google_tokens").select("*").eq("user_id",e).single();if(r||!t)throw Error("Google token not found for user");let o=t.access_token,s=t.property_id;if(!o||!s)throw Error("Missing access token or property ID");let i=`https://analyticsdata.googleapis.com/v1beta/properties/${s}:runReport`,c=await a()(i,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({dateRanges:[{startDate:"7daysAgo",endDate:"today"}],metrics:[{name:"activeUsers"},{name:"sessions"}]})});if(!c.ok){let e=await c.json();throw Error(`Failed to fetch analytics data: ${e.error.message||c.statusText}`)}return await c.json()}catch(e){throw console.error("Error in fetchAnalyticsData:",e),e}}},33480:(e,t,r)=>{e.exports=r(75600)},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=21202);module.exports=r})();