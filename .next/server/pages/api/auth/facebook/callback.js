(()=>{var e={};e.id=9646,e.ids=[9646],e.modules={8667:(e,r)=>{"use strict";Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},12541:(e,r,t)=>{"use strict";t.d(r,{A:()=>o});let o=(0,require("@supabase/supabase-js").createClient)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{persistSession:!0}})},24701:(e,r,t)=>{"use strict";t.d(r,{Fd:()=>l,gf:()=>u});var o=t(49157),n=t.n(o),s=t(12541);let a=process.env.FACEBOOK_CLIENT_ID,i=process.env.FACEBOOK_CLIENT_SECRET,c=process.env.FACEBOOK_API_VERSION||"v12.0";async function u(e,r){try{let t="https://graph.facebook.com/"+c+"/oauth/access_token?client_id="+a+"&redirect_uri="+encodeURIComponent(r)+"&client_secret="+i+"&code="+e,o=await n()(t),s=await o.json();if(s.error)throw Error(s.error.message);return s}catch(e){throw console.error("Error in getToken:",e),e}}async function l(e){try{let{data:r,error:t}=await s.A.from("connections").select("access_token").eq("user_id",e).single();if(t||!r)throw Error("No connection record found for the user.");let o=r.access_token,a=await n()("https://graph.facebook.com/"+c+"/me/adaccounts?fields=campaigns{id,name,status}&access_token="+o),i=await a.json();if(i.error)throw Error(i.error.message);return i}catch(e){throw console.error("Error in fetchData:",e),e}}},33480:(e,r,t)=>{"use strict";e.exports=t(75600)},49157:()=>{},75600:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},76117:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let o=require("jsonwebtoken");var n=t.n(o);function s(e){return async function(r,t){try{let o=r.headers.authorization||"",s=o.startsWith("Bearer ")?o.substring(7):null;if(!s)return t.status(401).json({error:"Missing authorization token"});return r.user=function(e){let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET is not configured");return n().verify(e,r)}(s),e(r,t)}catch(e){return console.error("JWT middleware error:",e),t.status(401).json({error:"Invalid or expired token"})}}}},85906:(e,r,t)=>{"use strict";t.r(r),t.d(r,{config:()=>f,default:()=>d,routeModule:()=>p});var o={};t.r(o),t.d(o,{default:()=>l});var n=t(33480),s=t(8667),a=t(86435),i=t(24701),c=t(12541);async function u(e,r){try{let{code:t,redirectUri:o}=e.query;if(!t||!o)return r.status(400).json({error:"Missing code or redirectUri"});let n=await (0,i.gf)(t,o),s=e.user?.id;if(!s)return r.status(401).json({error:"Unauthorized user"});let{error:a}=await c.A.from("connections").upsert({user_id:s,provider:"facebook",access_token:n.access_token,refresh_token:n.refresh_token||null,expires_in:n.expires_in||null});if(a)throw Error("Failed to store connection: "+a.message);return r.status(200).json({success:!0,message:"Facebook connection successful"})}catch(e){return console.error("Error in Facebook callback:",e),r.status(500).json({error:e.message})}}let l=(0,t(76117).A)(u),d=(0,a.M)(o,"default"),f=(0,a.M)(o,"config"),p=new n.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/auth/facebook/callback",pathname:"/api/auth/facebook/callback",bundlePath:"",filename:""},userland:o})},86435:(e,r)=>{"use strict";Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=85906);module.exports=t})();