"use strict";(()=>{var e={};e.id=8889,e.ids=[8889],e.modules={8667:(e,a)=>{Object.defineProperty(a,"A",{enumerable:!0,get:function(){return n}});var n=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},10093:(e,a,n)=>{n.r(a),n.d(a,{config:()=>m,default:()=>u,routeModule:()=>c});var t={};n.r(t),n.d(t,{default:()=>p});var r=n(33480),o=n(8667),s=n(86435);let i={high_engagement:{primary:"whatsapp",reason:"High engagement user - WhatsApp has 98% open rate",probability:.95},low_engagement:{primary:"email",reason:"Low engagement user - Email allows for detailed messaging",probability:.85},vip_customer:{primary:"email",reason:"VIP customer - Email provides professional communication",probability:.9},abandoned_cart:{primary:"whatsapp",reason:"Abandoned cart - WhatsApp creates urgency and immediate response",probability:.88},product_view:{primary:"instagram_dm",reason:"Product view - Instagram DM is less intrusive for browsing",probability:.82},checkout_fail:{primary:"whatsapp",reason:"Checkout failure - WhatsApp enables immediate customer support",probability:.92}},l={whatsapp:{openRate:.98,responseRate:.45,conversionRate:.12,avgResponseTime:2.5},email:{openRate:.25,responseRate:.08,conversionRate:.03,avgResponseTime:240},instagram_dm:{openRate:.85,responseRate:.32,conversionRate:.08,avgResponseTime:15}};async function p(e,a){if("POST"!==e.method)return a.status(405).json({error:"Method not allowed"});try{let{customerId:n,messageType:t,previousEngagement:r=[],preferredChannels:o=[]}=e.body;if(!n||!t)return a.status(400).json({error:"Missing required fields"});let s=function(e=[]){let a={whatsappCount:0,emailCount:0,instagramCount:0,totalEngagement:0,lastEngagement:null,preferredChannel:null};return e.forEach(e=>{switch(a.totalEngagement++,e.channel){case"whatsapp":a.whatsappCount++;break;case"email":a.emailCount++;break;case"instagram_dm":a.instagramCount++}}),a.whatsappCount>a.emailCount&&a.whatsappCount>a.instagramCount?a.preferredChannel="whatsapp":a.emailCount>a.instagramCount?a.preferredChannel="email":a.preferredChannel="instagram_dm",a}(r);s.totalEngagement>10||s.totalEngagement;let p=i[t]||i.low_engagement,u=p.primary,m=p.reason,c=p.probability;if(s.preferredChannel&&s.preferredChannel!==u){let e=l[s.preferredChannel],a=l[u];e.conversionRate>.8*a.conversionRate&&(u=s.preferredChannel,m=`Customer prefers ${u} based on engagement history`,c=function(e,a,n,t){let r=t[e].conversionRate;switch(n.preferredChannel===e&&(r*=1.3),a){case"abandoned_cart":"whatsapp"===e&&(r*=1.2);break;case"product_view":"instagram_dm"===e&&(r*=1.1);break;case"checkout_fail":"whatsapp"===e&&(r*=1.4)}return Math.min(r,.95)}(u,t,s,l))}o.length>0&&o.includes(u)&&(c*=1.1);let d={channel:u,reason:m,successProbability:c};return console.log("AI Channel Selection:",{customerId:n,messageType:t,selectedChannel:d.channel,reason:d.reason,successProbability:d.successProbability,customerBehavior:s,timestamp:new Date().toISOString()}),a.status(200).json(d)}catch(e){return console.error("Error selecting optimal channel:",e),a.status(500).json({error:"Failed to select optimal channel"})}}let u=(0,s.M)(t,"default"),m=(0,s.M)(t,"config"),c=new r.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/ai-auto-messages/select-channel",pathname:"/api/ai-auto-messages/select-channel",bundlePath:"",filename:""},userland:t})},33480:(e,a,n)=>{e.exports=n(75600)},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,a)=>{Object.defineProperty(a,"M",{enumerable:!0,get:function(){return function e(a,n){return n in a?a[n]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,n)):"function"==typeof a&&"default"===n?a:void 0}}})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var n=a(a.s=10093);module.exports=n})();